set autoindent
set background=dark
set backspace=indent,eol,start
set colorcolumn=80
set cursorline
set foldmethod=marker
set hidden
set history=1000
set hlsearch
set ignorecase
set incsearch
set laststatus=2
set list
set listchars=nbsp:¬,eol:↳,tab:└─,extends:»,precedes:«,trail:•
set mat=2
set nocindent
set nocompatible
set number
set pastetoggle=<F2>
set rtp+=~/.vim/bundle/vundle/
set shiftwidth=4
set showmatch
set smartcase
set smartindent
set t_Co=256
set tabstop=4
set textwidth=0
set tm=500
set ttyfast
set undodir=~/.vim/undofiles
set undofile
set undolevels=1000
set wildmenu
set wildmode=list:longest

call vundle#rc()

Bundle 'gmarik/vundle'
Bundle 'bling/vim-airline'
Bundle 'bling/vim-bufferline'
Bundle 'ervandew/supertab'
Bundle 'garbas/vim-snipmate'
Bundle 'groenewege/vim-less'
Bundle 'joshtronic/php.vim'
Bundle 'joshtronic/vim-snippets'
Bundle 'kien/ctrlp.vim'
"Bundle 'kshenoy/vim-signature' " Errors... really want to use it tho
Bundle 'Lokaltog/vim-easymotion'
Bundle 'MarcWeber/vim-addon-mw-utils'
Bundle 'nanotech/jellybeans.vim'
Bundle 'othree/html5.vim'
Bundle 'pangloss/vim-javascript.git'
Bundle 'rstacruz/sparkup', {'rtp': 'vim/'}
Bundle 'scrooloose/nerdcommenter'
Bundle 'scrooloose/nerdtree'
Bundle 'scrooloose/syntastic'
Bundle 'SearchComplete'
Bundle 'tomtom/tlib_vim'
Bundle 'tpope/vim-fugitive'
Bundle 'tpope/vim-surround'

autocmd BufEnter * match ExtraWhitespace /\s\+$/
autocmd BufNewFile,BufRead *.less set filetype=less
autocmd ColorScheme * highlight ExtraWhitespace guibg=red
autocmd FileType c set omnifunc=ccomplete#CompleteCpp
autocmd FileType css set omnifunc=csscomplete#CompleteCSS
autocmd FileType html set omnifunc=htmlcomplete#CompleteTags
autocmd FileType javascript set omnifunc=javascriptcomplete#CompleteJS
autocmd FileType php set omnifunc=phpcomplete#CompletePHP
autocmd FileType python set omnifunc=pythoncomplete#Complete
autocmd FileType svn,*commit* setlocal spell
autocmd FileType xml set omnifunc=xmlcomplete#CompleteTags
autocmd InsertEnter * match ExtraWhitespace /\s\+\%#\@<!$/
autocmd InsertLeave * match ExtraWhiteSpace /\s\+$/

" Allows fugitive to browse the parent tree
autocmd BufReadPost fugitive://* set bufhidden=delete
autocmd BufReadPost fugitive://*
	\ if fugitive#buffer().type() =~# '^\%(tree\|blob\)$' |
	\   nnoremap <buffer> .. :edit %:h<CR> |
	\ endif

colorscheme jellybeans

highlight Conditional ctermfg=2
highlight Constant cterm=NONE ctermfg=2
highlight ExtraWhitespace ctermbg=red guibg=red
highlight Function cterm=NONE ctermfg=2
highlight link javaScriptBraces NONE
highlight NonText ctermfg=237 guifg=#303030
highlight Number cterm=NONE ctermfg=darkred
highlight Search cterm=NONE ctermfg=NONE
highlight SpecialKey ctermfg=red guifg=#303030
highlight Statement cterm=NONE ctermfg=2
highlight String cterm=NONE ctermfg=darkred

let mapleader = ','
let g:airline_powerline_fonts = 1
let g:airline_theme_patch_func = 'AirlineThemePatch'
let g:NERDTreeMouseMode = 3
let g:NERDTreeWinSize = 40

nmap <silent> ,/ :nohlsearch<CR>
nnoremap ; :
nnoremap <Leader>[ :previous<CR>
nnoremap <Leader>] :next<CR>
nnoremap <Leader>{ :first<CR>
nnoremap <Leader>} :last<CR>
nnoremap <Leader>3 :set nonumber<CR>
nnoremap <Leader># :set number<CR>
nnoremap <Leader>8 :set colorcolumn=+1<CR>
nnoremap <Leader>* :set colorcolumn=80<CR>
nnoremap <Leader>b :BundleUpdate<CR>:q<CR>
nnoremap <Leader>c :!wc %<CR>
nnoremap <Leader>f :set nolist<CR>
nnoremap <Leader>F :set list<CR>
nnoremap <Leader>n :NERDTree<CR>
nnoremap <Leader>q :q<CR>
nnoremap <Leader>r :silent !~/Source/dotfiles/scripts/refresh-safari<CR>:redraw!<CR>
nnoremap <Leader>ss / $<CR>
nnoremap <Leader>tt /\t$<CR>
nnoremap <Leader>v :so %<CR>
nnoremap <Leader>w :w<CR>
nnoremap <Leader>ww :w!<CR>

syntax on
syntax sync fromstart

vnoremap * :<C-u>call <SID>VSetSearch()<CR>//<CR>
vnoremap # :<C-u>call <SID>VSetSearch()<CR>??<CR>

" Jumps to last cursor position except on commit messages
autocmd BufReadPost * call SetCursorPosition()
function! SetCursorPosition()
	if &filetype !~ 'svn\|commit\c'
		if line("'\"") > 0 && line("'\"") <= line("$")
			exe "normal! g`\""
			normal! zz
		endif
	endif
endfunction

" Search for selected text
function! s:VSetSearch()
	let temp = @@
	norm! gvy
	let @/ = '\V' . substitute(escape(@@, '\'), '\n', '\\n', 'g')
	let @@ = temp
endfunction

" Force airline's color scheme
function! AirlineThemePatch(palette)
	let a:palette.normal.airline_a = [ '#ffffff', '#268bd2', 255, 33 ]
endfunction
