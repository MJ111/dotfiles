#!/usr/bin/env bash

if [ -z "$HOME" ]; then echo "Seems you don't have a \$HOME :("; exit 1; fi

DOTFILES=$HOME/.dotfiles

rm -rf $DOTFILES
mkdir $DOTFILES
cd $DOTFILES

git init
git remote add origin git@github.com:joshtronic/dotfiles.git
git pull origin master
git submodule update --init --recursive

rm -rf $HOME/.gemrc $HOME/.gitconfig $HOME/.grcat $HOME/.my.cnf \
    .$HOME/tmux.conf $HOME/.tmuxinator $HOME/.vim $HOME/.zshrc

ln -s $DOTFILES/gemrc $HOME/.gemrc
ln -s $DOTFILES/gitconfig $HOME/.gitconfig
ln -s $DOTFILES/my.cnf $HOME/.my.cnf
ln -s $DOTFILES/tmux.conf $HOME/.tmux.conf
ln -s $DOTFILES/tmuxiantor $HOME/.tmuxinator
ln -s $DOTFILES/vim $HOME/.vim
ln -s $DOTFILES/zsh/zshrc $HOME/.zshrc
ln -s $DOTFILES/vendor/nitso/colour-mysql-console/.grcat $HOME/.grcat

if [[ `uname` == 'Darwin' ]]; then
    # TODO: OS X
    # 1) Install homebrew
    # 2) Install docker
    # 3) Install ship from github repo (for any OS)
    # 4) Configure Terminal.app
    # 5) Install karabiner

    defaults write com.apple.dock autohide-delay -float 86400; killall Dock
    defaults write -g ApplePressAndHoldEnabled -bool false

    rm -rf $HOME/Library/Application\ Support/Karabiner
    ln -s $DOTFILES/karabiner $HOME/Library/Application\ Support/Karabiner

    /Applications/Karabiner.app/Contents/Library/bin/karabiner reloadxml
    /Applications/Karabiner.app/Contents/Library/bin/karabiner enable rightCommand
    /Applications/Karabiner.app/Contents/Library/bin/karabiner enable rightCommandH
    /Applications/Karabiner.app/Contents/Library/bin/karabiner enable rightCommandJ
    /Applications/Karabiner.app/Contents/Library/bin/karabiner enable rightCommandK
    /Applications/Karabiner.app/Contents/Library/bin/karabiner enable rightCommandL
    /Applications/Karabiner.app/Contents/Library/bin/karabiner enable rightCommand1
    /Applications/Karabiner.app/Contents/Library/bin/karabiner enable rightCommand2
    /Applications/Karabiner.app/Contents/Library/bin/karabiner enable rightCommand3
    /Applications/Karabiner.app/Contents/Library/bin/karabiner enable rightCommand4
    /Applications/Karabiner.app/Contents/Library/bin/karabiner enable rightCommand5

    brew update
    brew upgrade

    brew install bash fabric git git-extras gpg grc htop httpie hub mtr \
        multitail reattach-to-user-namespace ship ssh-copy-id tmux tree vim wget
elif [[ `uname` == 'Linux' && `which apt-get` ]]; then
    rm -rf .Xmodmap
    ln -s $DOTFILES/Xmodmap $HOME/.Xmodmap

    sudo add-apt-repository ppa:jonathonf/vim
    sudo add-apt-repository ppa:ne0sight/chrome-gnome-shell

    sudo apt-get update
    sudo apt-get upgrade

    # TODO: Ubuntu Linux
    # 1) Detect if MB: echo 0 > /sys/module/hid_apple/parameters/iso_layout
    # 2) Swap CAPS for CTRL
    # 3) https://github.com/seatgeek/bash-aptfile
    # 4) Install docker
    # 5) Install docker-compose

    sudo apt-get install chrome-gnome-shell compizconfig-settings-manager \
        compiz-plugins-extra gimp gnome-shell gnome-tweak-tool \
        google-chrome-stable grc httpie i3 inkscape nmap nodejs tmuxinator \
        vlc vim whois xclip xserver-xorg-input-libinput
fi

sudo gem install bundler
if [[ `uname` == 'Darwin' ]]; then sudo gem install tmuxinator; fi

vim +PluginInstall +qall

source $HOME/.zshrc
cd $HOME

